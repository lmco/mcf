<%
const projects = org.projects;
const members = org.permissions.read;
%>

<div class="container mbee-organization">

  <nav aria-label="breadcrumb">
    <ol class="breadcrumb">
      <li class="breadcrumb-item"><a href="/">Home</a></li>
      <li class="breadcrumb-item"><a href="/organizations">Organizations</a></li>
      <li class="breadcrumb-item"><a href="/<%= org.id %>"><%= org.name %></a></li>
      <li class="breadcrumb-item active" aria-current="page">edit</li>
    </ol>
  </nav>
  <hr class="mb-4">
  <div class="org-header">
    <h1 class="display-4"><%= org.name%></h1>
  </div>

  <form>
    <div class="form-group">
      <label for="name">Organization Name</label>
      <input class="form-control" id="name" aria-describedby="emailHelp" placeholder="Organization Name" value="<%= org.name %>">
    </div>
    <div class="form-group">
      <label for="custom">Custom Data</label>
      <textarea class="form-control" id="custom" rows="10" placeholder="Custom Data"><%= JSON.stringify(org.custom, null, 2) %></textarea>
    </div>
    <button id="subitForm" type="button" class="btn btn-primary">Save</button>
  </form>

</div>

<%- contentFor('scripts') %>
<script>
  $(document).ready(function() {
    $('#subitForm').click(function() {
      try {
        JSON.parse($("#custom").val())
      }
      catch {
        $('#custom').effect('shake')
        return
      }
      jQuery.ajax({
        method: "PATCH",
        url: "<%= `/api/orgs/${org.id}` %>",
        data: {name: $("#name").val(), custom: JSON.parse($("#custom").val())}
      })
      .done(function (msg, status) {
        $(location).attr('href',"<%= `/${org.id}/edit` %>")
      })
      .fail(function(msg) {
        console.log(msg);
      })
    });
  });
</script>
