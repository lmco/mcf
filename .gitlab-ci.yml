variables:
  HTTP_PROXY: http://proxy3.lmco.com:80
  HTTPS_PROXY: http://proxy3.lmco.com:80
  http_proxy: http://proxy3.lmco.com:80
  https_proxy: http://proxy3.lmco.com:80
  NO_PROXY: 127.0.0.1,localhost

stages:
  - Build
  - Test
  - Prep DevOps


Build MCF:
  image: registry.gitlab.us.lmco.com:443/mbx/mbee/mcf/gitlab-build-image:latest
  stage: Build
  dependencies: []
  script:
    - export HTTP_PROXY=http://proxy3.lmco.com:80
    - export HTTPS_PROXY=http://proxy3.lmco.com:80
    - export NO_PROXY=127.0.0.1,localhost
    - yarn config set strict-ssl false
    - yarn config set proxy http://proxy3.lmco.com:80 -g
    - yarn config set https-proxy http://proxy3.lmco.com:80 -g
    - yarn config set no_proxy 127.0.0.1,localhost -g
    - NOPOSTINSTALL=1 NOPREINSTALL=1 yarn install
    - node mbee migrate -y
    - sleep 5
    - node mbee test
